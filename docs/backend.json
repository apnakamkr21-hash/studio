{
  "entities": {
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an event on campus.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the event."
        },
        "title": {
          "type": "string",
          "description": "The title of the event."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the event."
        },
        "date": {
          "type": "string",
          "description": "The date and time of the event.",
          "format": "date-time"
        },
        "venue": {
          "type": "string",
          "description": "The location of the event."
        },
        "price": {
          "type": "number",
          "description": "The price of a ticket for the event."
        },
        "committeeId": {
          "type": "string",
          "description": "Reference to the Committee organizing the event. (Relationship: Committee 1:N Event)"
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the event poster image."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "date",
        "venue",
        "price",
        "committeeId"
      ]
    },
    "Committee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Committee",
      "type": "object",
      "description": "Represents a campus committee organizing events.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the committee."
        },
        "name": {
          "type": "string",
          "description": "The name of the committee."
        },
        "description": {
          "type": "string",
          "description": "A description of the committee."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the committee's logo image."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Booking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a student for an event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the booking."
        },
        "eventId": {
          "type": "string",
          "description": "Reference to the Event that was booked. (Relationship: Event 1:N Booking)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who made the booking. (Relationship: User 1:N Booking)"
        },
        "bookingDate": {
          "type": "string",
          "description": "The date and time the booking was made.",
          "format": "date-time"
        },
        "qrCode": {
          "type": "string",
          "description": "The QR code associated with the ticket."
        }
      },
      "required": [
        "id",
        "eventId",
        "userId",
        "bookingDate",
        "qrCode"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user (student) in the system.  Authentication data (e.g. passwords) is not stored here, and an external authentication service is presumed to be in use.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "name": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture."
        }
      },
      "required": [
        "id",
        "name",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/committees/{committeeId}",
        "definition": {
          "entityName": "Committee",
          "schema": {
            "$ref": "#/backend/entities/Committee"
          },
          "description": "Stores committee profiles.  Committee ID is used as document ID.",
          "params": [
            {
              "name": "committeeId",
              "description": "The unique identifier of the committee."
            }
          ]
        }
      },
      {
        "path": "/committees/{committeeId}/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores events organized by a specific committee. Includes denormalized 'committeeId' field to ensure authorization independence, allowing secure event creation rules.",
          "params": [
            {
              "name": "committeeId",
              "description": "The unique identifier of the committee organizing the event."
            },
            {
              "name": "eventId",
              "description": "The unique identifier of the event."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  User ID is used as document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores event bookings made by a specific user.  Path-based ownership guarantees user-specific read/write access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who made the booking."
            },
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a campus event booking application, focusing on security, scalability, and ease of management. The structure adheres to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Queries are not Filters), and Invariants.\n\n**Authorization Independence:** This is achieved primarily through denormalization. Specifically, the `Event` documents store the `committeeId`. This allows security rules to validate that the committee creating the event is indeed the committee specified without needing to perform a `get()` operation. User-specific bookings are handled under the `/users/{userId}/bookings/{bookingId}` path, implicitly granting the user ownership over their booking data. Bookings also store the `eventId` for listing events booked by a particular user.\n\n**Clarity of Intent:** The path structure clearly reflects ownership and relationships. Events are organized under committees, and bookings are organized under users. The naming conventions are explicit and semantic.\n\n**DBAC (No Custom Claims):** Authorization is based solely on `request.auth.uid` and data stored in the database. No custom claims are used.  The hierarchical path `/users/{userId}/bookings/{bookingId}` is crucial for this.\n\n**QAPs (Rules are not Filters):** The structure supports secure `list` operations.  For example, listing all events for a specific committee is possible via a collection group query. User-specific bookings can be listed securely under the `/users/{userId}/bookings` path. Because the data is denormalized (Authorization Independence), security rules can validate list operations without needing to filter based on data lookups.\n\n**Invariants:** The structure facilitates maintaining data integrity. Ownership is explicitly defined in the paths. Timestamps can be enforced via server-side timestamps on creation and modification.  The inclusion of `committeeId` on the `Event` allows straightforward enforcement of which committees can create events.\n\nIn summary, the design prioritizes security and scalability by denormalizing key authorization information, structuring data for efficient querying and filtering, and adhering to consistent naming conventions."
  }
}